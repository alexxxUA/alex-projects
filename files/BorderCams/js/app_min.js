class ServiceWorker{constructor(){this.swUrl="/sw.js",this.init()}init(){if(navigator.serviceWorker&&!navigator.serviceWorker.controller)return navigator.serviceWorker.register(this.swUrl).then(function(){console.info("Service worker registered")})}}class ProxyParser{constructor(){this.proxyHref="/proxy?url=",this.proxyUrl=`${location.origin}${this.proxyHref}`,this.domParser=new DOMParser}doProxyFetch(t,e=!1){return fetch(`${this.proxyUrl}${t}${e?"&decode=true":""}`).then(t=>t.text())}doPageFetch(t,e=!1){return this.doProxyFetch(t,e).then(this.blockResources).then(this.convertHtmlToDom.bind(this))}blockResources(t){return t.replace(/src=/gm,"x-src=").replace(/href=/gm,"x-href=")}convertHtmlToDom(t){return this.domParser.parseFromString(t,"text/html")}}class BorderCams extends ProxyParser{constructor(){super(),this.camsUrl="https://dpsu.gov.ua/ua/border/",this.textBorderDataUrl="https://www.financnasprava.sk/sk/infoservis/hranicne-priechody",this.camSel={countries:'[data-id="select-country"] option',checkpoints:'[data-id="select-town"] option'},this.textDataSel={borders:"#tblPriechody tbody tr"},this.textDataIdMap={UZHGOROD1:"нємецьке|німецьке|nemecké|nemecke",uzhgorod:"нємецьке|німецьке|nemecké|nemecke",m_berezny:"убля|ubľa|m_berezny"},this.favoritePoints=["UZHGOROD1","uzhgorod","m_berezny","007_Tisa_rear"],this.predefinedPoints={slovakia:[{id:"uzhgorod",name:"Ужгород-КПП - Вишнє-Немецьке",src:"https://stream.dpsu.gov.ua:5101/uzhgorod/embed.html?dvr=false&proto=hls&autoplay=true"}]},this.translateMap={"звичайний":"priebežne|priebezne"},this.init()}init(){const t=void 0!==window.orientation;document.body.classList.add(t?"mobile":"desktop"),this.renderApp()}async renderApp(){const t=this,[e,r]=await this.getData();Vue.component("border-cams",{data(){const s={camsData:{},favoritePoints:t.favoritePoints,favoriteItems:[],err:null,streamSrc:null,textData:r,textBorderDataUrl:t.textBorderDataUrl};return e?(s.camsData=e,s.favoriteItems=t.getCamsDataById(e,t.favoritePoints),s.favoriteItems.length&&(s.streamSrc=s.favoriteItems[0].src)):s.err="Камери тимчасово недоступні 🤕, cпробуйте пізніше.",s},computed:{activeCamData(){let t;if(this.streamSrc){t=this.favoriteItems.find(t=>t.src===this.streamSrc);const e=this.textData[t.id];e&&Object.keys(e).length&&Object.assign(t,e,{textData:!0})}return t},streamSrcFormatted(){return`javascript:window.location.replace('${this.streamSrc}');`}},methods:{selectCam(t){this.streamSrc!==t&&(this.streamSrc=t,clearTimeout(this.animationTimeout),this.$refs.streamWrap.classList.add("m-switch"),this.animationTimeout=setTimeout(()=>{this.$refs.streamWrap.classList.remove("m-switch")},700))},onCamLoad(t){t.currentTarget.src!=this.streamSrc&&(t.currentTarget.src=this.streamSrc)},translate(e){let r=e;return Object.keys(t.translateMap).forEach(e=>{const s=new RegExp(t.translateMap[e],"igm");r=r.replace(s,e)}),r}},mounted(){console.log("mounted")},ready(){console.log("ready")},created(){console.log("created")}}),new Vue({el:"#app"})}alphabetSort(t,e,r){return e[t]<r[t]?1:e[t]>r[t]?-1:0}getData(){const t=this.doPageFetch(this.camsUrl,!0).then(this.parseCamsData.bind(this)).then(this.mergeCamsData.bind(this)),e=this.doPageFetch(this.textBorderDataUrl).then(this.parseTextBorderData.bind(this));return Promise.all([t,e])}mergeCamsData(t){const e=t;return Object.keys(this.predefinedPoints).forEach(t=>{e[t]||(e[t]={checkpoints:[]}),e[t].checkpoints=e[t].checkpoints.concat(this.predefinedPoints[t])}),e}getCamsDataById(t,e){const r=[];return("string"==typeof e?[e]:e).forEach(e=>{let s;const a=Object.keys(t);for(let o=0;o<a.length;o++){const i=t[a[o]].checkpoints;for(let t=0;t<i.length;t++){const a=i[t];if(a.id===e){r.push(a),s=a;break}}if(s)break}}),r}parseCamsData(t){let e={};const r=t.querySelectorAll(this.camSel.countries),s=t.querySelectorAll(this.camSel.checkpoints);return r.length&&s.length?(e=Array.prototype.reduce.call(r,(t,{value:e,text:r})=>(t[e]={name:r.trim(),checkpoints:[]},t),{}),s.forEach(({value:t,text:r,dataset:{link:s}})=>{if(e[t]){const a={id:this.getIdFromUrl(s)||r,name:r,src:this.updateStreamSrc(s)};e[t].checkpoints.push(a)}}),e):(this.error(`${this.camSel.countries} or ${this.camSel.checkpoints} not found on source page!`),e)}getIdFromUrl(t){let e;const r=/\/([^\/:]+)\//.exec(t);return r&&r.length>1&&(e=r[1]),e}parseTextBorderData(t){const e=t.querySelectorAll(this.textDataSel.borders);return e&&0!==e.length?[...e].reduce((t,e)=>{const r={name2:"td:nth-child(1)",waitTimeToEU:"td:nth-child(3)",waitTimeToUA:"td:nth-child(6)",note:"td:nth-child(8)",updatedTime:"td:nth-child(9)"},s=Object.keys(r).reduce((t,s)=>(t[s]=e.querySelector(r[s]).innerText.trim(),t),{}),a=this.findIdsByNameFromMap(s.name2);return a.length?a.forEach(e=>t[e]=s):this.error(`Id not found for text data for: "${s.name2}"`),t},{}):(this.error("Text data for SK borders not found."),{})}updateStreamSrc(t){const e=new URL(t);return e.searchParams.get("autoplay")||e.searchParams.set("autoplay",!0),e.searchParams.get("mute")||e.searchParams.set("mute",!0),e.href}findIdsByNameFromMap(t){const e=[];return Object.keys(this.textDataIdMap).forEach(r=>{new RegExp(this.textDataIdMap[r],"i").test(t)&&e.push(r)}),e}error(t){console.error(t)}}const sw=new ServiceWorker,borderCams=new BorderCams;