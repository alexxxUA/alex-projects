class ServiceWorker{constructor(){this.swUrl="/sw.js",this.init()}init(){if(navigator.serviceWorker&&!navigator.serviceWorker.controller)return navigator.serviceWorker.register(this.swUrl).then(function(){console.info("Service worker registered")})}}class ProxyParser{constructor(){this.proxyHref="/proxy?url=",this.proxyUrl=`${location.origin}${this.proxyHref}`,this.domParser=new DOMParser}doProxyFetch(t){return fetch(`${this.proxyUrl}${t}`).then(t=>t.text())}doPageFetch(t){return this.doProxyFetch(t).then(this.blockResources).then(this.convertHtmlToDom.bind(this))}blockResources(t){return t.replace(/src=/gm,"x-src=").replace(/href=/gm,"x-href=")}convertHtmlToDom(t){return this.domParser.parseFromString(t,"text/html")}}class BorderCams extends ProxyParser{constructor(){super(),this.camsUrl="https://dpsu.gov.ua/ua/border/",this.textBorderDataUrl="https://www.financnasprava.sk/sk/infoservis/hranicne-priechody",this.camSel={countries:'[data-id="country"] option',checkpoints:'[data-id="puncts"] option'},this.textDataSel={borders:"#tblPriechody tbody tr"},this.slugMap={VN:"Ð½Ñ”Ð¼ÐµÑ†ÑŒÐºÐµ|Ð½Ñ–Ð¼ÐµÑ†ÑŒÐºÐµ|nemeckÃ©|nemecke",UBLA:"ÑƒÐ±Ð»Ñ|ubÄ¾a|ubla",SLME:"ÑÐµÐ»Ð¼ÐµÐ½Ñ†Ðµ|slemence",ZAH:"Ð·Ð°Ñ…Ð¾Ð½ÑŒ"},this.favoriteCountries=["VN","UBLA","SLME","ZAH"],this.translateMap={"Ð·Ð²Ð¸Ñ‡Ð°Ð¹Ð½Ð¸Ð¹":"priebeÅ¾ne|priebezne"},this.init()}init(){const t=void 0!==window.orientation;document.body.classList.add(t?"mobile":"desktop"),this.renderApp()}async renderApp(){const t=this,[e,r]=await this.getData();Vue.component("border-cams",{data(){const s={camsData:{},favoriteItems:[],err:null,streamSrc:null,textData:r,textBorderDataUrl:t.textBorderDataUrl};return e?(s.camsData=e,s.favoriteItems=t.getCamsDataBySlug(e,t.favoriteCountries),s.favoriteItems.length&&(s.streamSrc=s.favoriteItems[0].src)):s.err="ÐšÐ°Ð¼ÐµÑ€Ð¸ Ñ‚Ð¸Ð¼Ñ‡Ð°ÑÐ¾Ð²Ð¾ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ– ðŸ¤•, cÐ¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ñ–Ð·Ð½Ñ–ÑˆÐµ.",s},computed:{activeCamData(){let t;if(this.streamSrc){t=this.favoriteItems.find(t=>t.src===this.streamSrc);const e=this.textData[t.slug];e&&Object.keys(e).length&&Object.assign(t,e,{textData:!0})}return t}},methods:{translate(e){let r=e;return Object.keys(t.translateMap).forEach(e=>{const s=new RegExp(t.translateMap[e],"igm");r=r.replace(s,e)}),r}},mounted(){console.log("mounted")},ready(){console.log("ready")},created(){console.log("created")}}),new Vue({el:"#app"})}alphabetSort(t,e,r){return e[t]<r[t]?1:e[t]>r[t]?-1:0}getData(){const t=this.doPageFetch(this.camsUrl).then(this.parseCamsData.bind(this)),e=this.doPageFetch(this.textBorderDataUrl).then(this.parseTextBorderData.bind(this));return Promise.all([t,e])}getCamsDataBySlug(t,e){const r=[];return e.forEach(e=>{let s;const a=Object.keys(t);for(let o=0;o<a.length;o++){const n=t[a[o]].checkpoints;for(let t=0;t<n.length;t++){const a=n[t];if(a.slug===e){r.push(a),s=a;break}}if(s)break}}),r}parseCamsData(t){const e=t.querySelectorAll(this.camSel.countries),r=t.querySelectorAll(this.camSel.checkpoints);if(!e.length||!r.length)return this.error(`${this.camSel.countries} or ${this.camSel.checkpoints} not found on source page!`),null;const s=Array.prototype.reduce.call(e,(t,{value:e,text:r})=>(t[e]={name:r.trim(),checkpoints:[]},t),{});return r.forEach(({value:t,text:e,dataset:r})=>{if(s[t]){const a={name:e,src:this.updateStreamSrc(r.link)},o=this.findSlugByName(e);o&&(a.slug=o),s[t].checkpoints.push(a)}}),s}parseTextBorderData(t){const e=t.querySelectorAll(this.textDataSel.borders);return e&&0!==e.length?[...e].reduce((t,e)=>{const r={name2:"td:nth-child(1)",waitTimeToEU:"td:nth-child(3)",waitTimeToUA:"td:nth-child(6)",note:"td:nth-child(8)",updatedTime:"td:nth-child(9)"},s=Object.keys(r).reduce((t,s)=>(t[s]=e.querySelector(r[s]).innerText.trim(),t),{}),a=this.findSlugByName(s.name2);return a?t[a]=s:this.error(`Slug not found for text data for: "${s.name2}"`),t},{}):(this.error("Text data for SK borders not found."),{})}updateStreamSrc(t){const e=new URL(t);return e.searchParams.get("autoplay")||e.searchParams.set("autoplay",!0),e.href}findSlugByName(t){let e;return Object.keys(this.slugMap).forEach(r=>{new RegExp(this.slugMap[r],"i").test(t)&&(e=r)}),e}error(t){console.error(t)}}const sw=new ServiceWorker,borderCams=new BorderCams;