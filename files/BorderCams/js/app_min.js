class ServiceWorker{constructor(){this.swUrl="/sw.js",this.init()}init(){if(navigator.serviceWorker&&!navigator.serviceWorker.controller)return navigator.serviceWorker.register(this.swUrl).then(function(){console.info("Service worker registered")})}}class ProxyParser{constructor(){this.proxyHref="/proxy?url=",this.proxyUrl=`${location.origin}${this.proxyHref}`,this.domParser=new DOMParser}doProxyFetch(t,e=!1){return fetch(`${this.proxyUrl}${t}${e?"&decode=true":""}`).then(t=>t.text())}doPageFetch(t,e=!1){return this.doProxyFetch(t,e).then(this.blockResources).then(this.convertHtmlToDom.bind(this))}blockResources(t){return t.replace(/src=/gm,"x-src=").replace(/href=/gm,"x-href=")}convertHtmlToDom(t){return this.domParser.parseFromString(t,"text/html")}}class BorderCams extends ProxyParser{constructor(){super(),this.camsUrl="https://dpsu.gov.ua/ua/border/",this.textBorderDataUrl="https://www.financnasprava.sk/sk/infoservis/hranicne-priechody",this.camSel={countries:'[data-id="select-country"] option',checkpoints:'[data-id="select-town"] option'},this.textDataSel={borders:"#tblPriechody tbody tr"},this.slugMap={VN:"нємецьке|німецьке|nemecké|nemecke",VN2:"нємецьке|німецьке|nemecké|nemecke",UBLA:"убля|ubľa|ubla",SLME:"селменце|slemence",ZAH:"захонь"},this.favoritePoints=["VN","VN2","UBLA","SLME","ZAH"],this.predefinedPoints=[{slug:"VN2",name:"Ужгород-КПП - Вишнє-Немецьке",src:"https://stream.dpsu.gov.ua:5101/uzhgorod/embed.html?dvr=false&proto=hls&autoplay=true"}],this.translateMap={"звичайний":"priebežne|priebezne"},this.init()}init(){const t=void 0!==window.orientation;document.body.classList.add(t?"mobile":"desktop"),this.renderApp()}async renderApp(){const t=this,[e,r]=await this.getData();Vue.component("border-cams",{data(){const s={camsData:{},favoritePoints:t.favoritePoints,favoriteItems:[],err:null,streamSrc:null,textData:r,textBorderDataUrl:t.textBorderDataUrl};return e?(s.camsData=e,s.favoriteItems=t.predefinedPoints.concat(t.getCamsDataBySlug(e,t.favoritePoints)),s.favoriteItems.length&&(s.streamSrc=s.favoriteItems[0].src)):s.err="Камери тимчасово недоступні 🤕, cпробуйте пізніше.",s},computed:{activeCamData(){let t;if(this.streamSrc){t=this.favoriteItems.find(t=>t.src===this.streamSrc);const e=this.textData[t.slug];e&&Object.keys(e).length&&Object.assign(t,e,{textData:!0})}return t},streamSrcFormatted(){return`javascript:window.location.replace('${this.streamSrc}');`}},methods:{selectCam(t){this.streamSrc!==t&&(this.streamSrc=t,clearTimeout(this.animationTimeout),this.$refs.streamWrap.classList.add("m-switch"),this.animationTimeout=setTimeout(()=>{this.$refs.streamWrap.classList.remove("m-switch")},700))},onCamLoad(t){t.currentTarget.src!=this.streamSrc&&(t.currentTarget.src=this.streamSrc)},translate(e){let r=e;return Object.keys(t.translateMap).forEach(e=>{const s=new RegExp(t.translateMap[e],"igm");r=r.replace(s,e)}),r}},mounted(){console.log("mounted")},ready(){console.log("ready")},created(){console.log("created")}}),new Vue({el:"#app"})}alphabetSort(t,e,r){return e[t]<r[t]?1:e[t]>r[t]?-1:0}getData(){const t=this.doPageFetch(this.camsUrl,!0).then(this.parseCamsData.bind(this)),e=this.doPageFetch(this.textBorderDataUrl).then(this.parseTextBorderData.bind(this));return Promise.all([t,e])}getCamsDataBySlug(t,e){const r=[];return e.forEach(e=>{let s;const a=Object.keys(t);for(let o=0;o<a.length;o++){const i=t[a[o]].checkpoints;for(let t=0;t<i.length;t++){const a=i[t];if(a.slug===e){r.push(a),s=a;break}}if(s)break}}),r}parseCamsData(t){const e=t.querySelectorAll(this.camSel.countries),r=t.querySelectorAll(this.camSel.checkpoints);if(!e.length||!r.length)return this.error(`${this.camSel.countries} or ${this.camSel.checkpoints} not found on source page!`),null;const s=Array.prototype.reduce.call(e,(t,{value:e,text:r})=>(t[e]={name:r.trim(),checkpoints:[]},t),{});return r.forEach(({value:t,text:e,dataset:r})=>{if(s[t]){const a={name:e,src:this.updateStreamSrc(r.link)},o=this.findSlugsByName(e);o.length&&(a.slug=o[0]),s[t].checkpoints.push(a)}}),s}parseTextBorderData(t){const e=t.querySelectorAll(this.textDataSel.borders);return e&&0!==e.length?[...e].reduce((t,e)=>{const r={name2:"td:nth-child(1)",waitTimeToEU:"td:nth-child(3)",waitTimeToUA:"td:nth-child(6)",note:"td:nth-child(8)",updatedTime:"td:nth-child(9)"},s=Object.keys(r).reduce((t,s)=>(t[s]=e.querySelector(r[s]).innerText.trim(),t),{}),a=this.findSlugsByName(s.name2);return a.length?a.forEach(e=>t[e]=s):this.error(`Slug not found for text data for: "${s.name2}"`),t},{}):(this.error("Text data for SK borders not found."),{})}updateStreamSrc(t){const e=new URL(t);return e.searchParams.get("autoplay")||e.searchParams.set("autoplay",!0),e.searchParams.get("mute")||e.searchParams.set("mute",!0),e.href}findSlugsByName(t){const e=[];return Object.keys(this.slugMap).forEach(r=>{new RegExp(this.slugMap[r],"i").test(t)&&e.push(r)}),e}error(t){console.error(t)}}const sw=new ServiceWorker,borderCams=new BorderCams;