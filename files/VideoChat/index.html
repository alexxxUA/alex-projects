<!DOCTYPE HTML>
<html ng-app="videoChat">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
	<title>Video chat</title>
	<link rel="shortcut icon" href="img/min/favicon.ico" type="image/x-icon">
	<!-- <link rel="stylesheet" href="css/base_min.css"> -->
	<link rel="stylesheet" href="css/reset.css">
	<link rel="stylesheet" href="css/bootstrap_3.2.0.min.css">
	<link rel="stylesheet" href="css/base.css">
</head>

<body ng-controller="ChatController as chat">
	<div class="main-wrap" ng-class="{'connected': local.trustStream, 'logged': isLogget, 'chat-open' : isChatOpen}">
		<div class="main-container">
            <div class="videos-container">
            	<div class="peers-container peers-{{objectSize(peers)}}">
            	    <div class="video-wrap" ng-repeat="(key, value) in peers">
						<video autoplay ng-src="{{peers[key].trustStream}}"></video>
					</div>
				</div>
				<div class="my-stream-container">
					<video autoplay muted ng-src="{{local.trustStream}}"></video>
				</div>
            </div>
			<div class="chat-container">
				<div class="chat-trigger" ng-class="{'unread' : isUnreadMsg, 'show-login' : isShowLogin}">
					<form name="chatForm" class="chat-login input-group" ng-submit="login()">
						<input type="text" class="form-control" placeholder="Your name for chat" ng-model="myName" required>
						<span class="input-group-btn">
							<button class="btn btn-info" type="submit">Login</button>
						</span>
					</form>

					<label for="openChat" title="Show chat">Chat</label>
					<input type="checkbox" id="openChat" ng-model="isChatOpen" ng-checked="isChatOpen" ng-change="chatTriggerChange()">
				</div>
				<div class="chat-wrap">
					<div class="chat-header">
						<h4>#{{room}}</h4>
					</div>
					<div class="chat-msgs" scroll-glue-bottom>
						<ul class="msgs-list">
							<li class="msg-item" ng-repeat="itemMsg in msgs" ng-class="{'local-msg' : itemMsg.isOwn}">
								<span class="name">{{itemMsg.name}}</span>
								<span class="msg" ng-bind-html="itemMsg.trustMsg"></span>
								<span class="time">{{itemMsg.time | date : 'HH:mm'}}</span>
							</li>
						</ul>
					</div>
					<form name="sendMsgForm" class="chat-send-msg input-group" ng-submit="sendMsg()">
						<textarea type="text" class="form-control" placeholder="Dear {{myName}}, type your message here..." required 
							ng-model="msg" ng-keyup="onMsgKeyUp($event)"></textarea>
						<span class="input-group-btn">
							<button class="btn btn-info" type="submit">Send</button>
						</span>
					</form>
				</div>
			</div>
		</div>
		<footer class="connect-bar">
			<div class="btn-connect ng-hide" title="Connect to the room" ng-click="connect(true)" ng-show="isHasWebCam">
				<img src="img/min/start-video-call.png" alt="Start video call">
			</div>
			<div class="btn-connect" title="Connect to the room" ng-click="connect()">
				<img src="img/min/start-call.png" alt="Start call">
			</div>
			<div class="btn-leave" title="Leave room" ng-click="leave()">
				<img src="img/min/end-call.png" alt="End call">
			</div>
		</footer>
	</div>
	<div class="script-section">
		<script>
			if(location.search.split('dev=')[1] == 'true'){
				document.write('<script src="app/librarys/detectRTC.js"><\/script>');
				document.write('<script src="app/librarys/icecomm.js"><\/script>');
				document.write('<script src="app/librarys/angular1.3.16.min.js"><\/script>');
				document.write('<script src="app/librarys/scrollglue.js"><\/script>');
				document.write('<script src="app/app.js"><\/script>');
				document.write('<script src="app/controllers/mainController.js"><\/script>');
				document.write('<script src="http://localhost:12345/livereload.js"><\/script>');
			}
			else{
				document.write('<script src="app/app_min.js"><\/script>');
			}
		</script>
	</div>
</body>

</html>